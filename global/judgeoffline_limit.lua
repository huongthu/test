
NUM_OFFLINE_PERMITREGION_MAX = 10; --   c¸ch kh«ng cho phÐp bµy qu¶n ®iÓm ®Ých nhá nhÊt b¸n kÝnh 

aryLimitRegion = { 
--   biÖn kinh 
[37]={ 
{1630, 3187},--  NPC phu xe 
{1704, 3224},--  NPC phu xe 
{1595, 2994},--  NPC phu xe 
{1860, 2928},--  NPC phu xe 
{1755, 3043},--   vâ l©m truyÒn nh©n 
{1806, 3098},--   lÔ quan 
{1712, 3102},--   thî rÌn 
{1747, 3050},--   thî rÌn 
{1773, 3090},--   tiÖm thuèc 
{1786, 3103},--   tiÖm t¹p hãa 
{1776, 3063},--   vâ l©m t©n tó liªn cuéc so tµi quan viªn 
{1740, 3065},--   thö luyÖn ®­êng 
{1646, 3050},--   niÕp sÜ trÇn 
{1589, 3096},--   tiÓu phiÕn 
{1784, 3042},--   néi c¸c th­îng th­ 
{1641, 3145},--   b×nh b×nh c« n­¬ng 
{16620, 3019},--   b×nh b×nh c« n­¬ng 
{1713, 374},--   b×nh b×nh c« n­¬ng 
{1865, 2968},--   b×nh b×nh c« n­¬ng 
{1734, 3102},--   d· tÈu 
{1693, 3212},--   c«ng thµnh phu xe 
}, 

--   §¹i Lý 
[162]={ 
{1669, 3124},--  NPC phu xe 
{1697, 3279},--  NPC phu xe 
{1469, 3269},--  NPC phu xe 
{1628, 3184},--   vâ l©m truyÒn nh©n 
{1587, 3221},--   lÔ quan 
{15599, 3262},--   thî rÌn 
{1449, 3211},--   tiÖm thuèc 
{1535, 3201},--   tiÖm t¹p hãa 
{1651, 3226},--   liªn cuéc so tµi sø gi¶ 
{1613, 3190},--   thö luyÖn ®­êng 
{1574, 3227},--   niÕp sÜ trÇn 
{1671, 3236},--   tiÓu phiÕn 
{1651, 3226},--   d· tÈu 
{1681, 3276},--   c«ng thµnh phu xe 
}, 

--   t­¬ng d­¬ng 
[78] = { 
{1509, 3140},--  NPC phu xe 
{1439, 3212},--  NPC phu xe 
{1598, 3378},--  NPC phu xe 
{1693, 3233},--  NPC phu xe 
{1609, 3259},--   vâ l©m truyÒn nh©n 
{1541, 3247},--   lÔ quan 
{1550, 3217},--   thî rÌn 
{1612, 3244},--   tiÖm thuèc 
{1628, 3262},--   tiÖm t¹p hãa 
{1546, 3118},--   vâ l©m t©n tó liªn cuéc so tµi quan viªn 
{1606, 3238},--   thö luyÖn ®­êng 
{1511, 3208},--   niÕp sÜ trÇn 
{1489, 3270},--   tiÓu phiÕn 
{1594, 3289},--   d· tÈu 
{1582, 3379},--   c«ng thµnh phu xe 
{1554, 3183},--   thÇn bÝ th­¬ng nh©n 
}, 

--   thµnh ®« 
[11]={ 
{3196, 5194},--  NPC phu xe 
{3266, 5003},--  NPC phu xe 
{3027, 4960},--  NPC phu xe 
{3017, 5090},--  NPC phu xe 
{3135, 5045},--   vâ l©m truyÒn nh©n 
{3126, 4994},--   lÔ quan 
{3104, 5121},--   thî rÌn 
{3141, 5136},--   tiÖm thuèc 
{3095, 5136},--   tiÖm t¹p hãa 
{3213, 5148},--   liªn cuéc so tµi sø gi¶ 
{3109, 5059},--   thö luyÖn ®­êng 
{3210, 4974},--   niÕp sÜ trÇn 
{3180, 4947},--   tiÓu phiÕn 
{3153, 5066},--   d· tÈu 
{3185, 5182},--   c«ng thµnh phu xe 
}, 

--   D­¬ng Ch©u 
[80]={ 
{1717, 3198},--  NPC phu xe 
{1592, 3195},--  NPC phu xe 
{1670, 2991},--  NPC phu xe 
{1825, 3064},--  NPC phu xe 
{1792, 3047},--   vâ l©m truyÒn nh©n 
{1745, 3000},--   lÔ quan 
{1689, 3170},--   thî rÌn 
{1773, 3079},--   tiÖm thuèc 
{1701, 3022},--   tiÖm t¹p hãa 
{1754, 3035},--   liªn cuéc so tµi sø gi¶ 
{1705, 3058},--   thö luyÖn ®­êng 
{1702, 2962},--   niÕp sÜ trÇn 
{1638, 3049},--   tiÓu phiÕn 
{1743, 2966},--   d· tÈu 
{1691, 3219},--   c«ng thµnh phu xe 
}, 

--   ph­îng t­êng 
[1]={ 
{1647, 3166},--  NPC phu xe 
{1557, 3108},--  NPC phu xe 
{1520, 3230},--  NPC phu xe 
{1652, 3281},--  NPC phu xe 
{1623, 3205},--   vâ l©m truyÒn nh©n 
{1614, 3152},--   lÔ quan 
{1618, 3196},--   thî rÌn 
{1604, 3190},--   tiÖm thuèc 
{1559, 3206},--   tiÖm t¹p hãa 
{1671, 3218},--   liªn cuéc so tµi sø gi¶ 
{1586, 3229},--   thö luyÖn ®­êng 
{1507, 3198},--   niÕp sÜ trÇn 
{1619, 3103},--   tiÓu phiÕn 
{1618, 3090},--   d· tÈu 
{1640, 3270},--   c«ng thµnh phu xe 
}, 

--   tr­íc khi an 
[176]={ 
{1606, 3292},--  NPC phu xe 
{1372, 3329},--  NPC phu xe 
{1601, 2912},--  NPC phu xe 
{1353, 3014},--  NPC phu xe 
{1532, 3010},--   vâ l©m truyÒn nh©n 
{1506, 2984},--   lÔ quan 
{1683, 3220},--   thî rÌn 
{1332, 3060},--   thî rÌn 
{1520, 2986},--   thî rÌn 
{1685, 3319},--   tiÖm thuèc 
{1474, 3362},--   tiÖm thuèc 
{1544, 2964},--   tiÖm thuèc 
{1615, 2977},--   tiÖm thuèc 
{1340, 3165},--   tiÖm t¹p hãa 
{1457, 3259},--   vâ l©m t©n tó liªn cuéc so tµi quan viªn 
{1592, 2944},--   thö luyÖn ®­êng 
{1371, 3007},--   niÕp sÜ trÇn 
{1387, 2961},--   tiÓu phiÕn 
{1561, 2980},--   d· tÈu 
{1689, 3291},--   c«ng thµnh phu xe 
{1654, 3263},--   th¾p ®Ìn cung n÷ 
{1439, 3268},--   th¾p ®Ìn cung n÷ 
{1384, 2979},--   th¾p ®Ìn cung n÷ 
{1576, 2958},--   th¾p ®Ìn cung n÷ 
{1314, 3195},--   thÇn bÝ thî rÌn 
{1412, 3312},--   minh chñ vâ l©m 
{1442, 3061},--   chu tiÒn trang 
{1478, 3237},--   néi c¸c th­îng th­ 
{1312, 2848},--   thÇn bÝ th­¬ng nh©n 
{1657, 3261},--   th¾p ®Ìn cung n÷ 
{1577, 2957},--   th¾p ®Ìn cung n÷ 
{1439, 3267},--   th¾p ®Ìn cung n÷ 
{1385, 2977},--   th¾p ®Ìn cung n÷ 
}, 

--   ba l¨ng huyÒn 
[53]={ 
{1626, 3172},--   d· tÈu 
{1629, 3195},--   lÔ quan 
{1598, 3209},--   tiÖm thuèc 
{1600, 3170},--   t¹p hãa 
{1578, 3236},--   phu xe 
}, 

--   giang th«n míi 
[20]={ 
{3538, 6231},--   d· tÈu 
{3552, 6192},--   lÔ quan 
{3469, 6164},--   tiÖm thuèc 
{3370, 6256},--   t¹p hãa 
{3458, 6110},--   phu xe 
{3522, 6117},--   nguyÖt l·o 
}, 

--   vÜnh nh¹c 
[99]={ 
{1646, 3192},--   d· tÈu 
{1614, 3177},--   lÔ quan 
{1595, 3227},--   tiÖm thuèc 
{1606, 3282},--   t¹p hãa 
{1630, 3304},--   phu xe 
{1607, 3161},--   
}, 

--   Chu tiªn trÊn 
[100]={ 
{1616, 3199},--   d· tÈu 
{1621, 3181},--   lÔ quan 
{1657, 3124},--   tiÖm thuèc 
{1641, 3126},--   t¹p hãa 
{1610, 3097},--   phu xe 
{1678, 3101},--   phu xe 
{1719, 3217},--   phu xe 
{1603, 3168},--   phu xe 
}, 

--   ®¹o h­¬ng th«n 
[101]={ 
{1677, 3143},--   d· tÈu 
{1671, 3172},--   lÔ quan 
{1679, 3196},--   tiÖm thuèc 
{1639, 3144},--   t¹p hãa 
{1623, 3098},--   phu xe 
}, 

--   long m«n trÊn 
[121]={ 
{1959, 4500},--   d· tÈu 
{1958, 4517},--   lÔ quan 
{1934, 4551},--   tiÖm thuèc 
{1914, 4524},--   t¹p hãa 
{1924, 4527},--   phu xe 
{1980, 4593},--   phu xe 
}, 

--   th¹ch cæ trÊn 
[123]={ 
{1643, 3235},--   d· tÈu 
{1606, 3227},--   lÔ quan 
{1600, 3209},--   tiÖm thuèc 
{1630, 3231},--   t¹p hãa 
{1658, 3244},--   phu xe 
}, 

--   long tuyÒn th«n 
[174]={ 
{1608, 3200},--   d· tÈu 
{1631, 3215},--   lÔ quan 
{1572, 3253},--   tiÖm thuèc 
{1566, 3202},--   t¹p hãa 
{1634, 3196},--   phu xe 
}, 

} 


--   kiÓm tr¾c nhµ ch¬i cã hay kh«ng ë h¹n chÕ khu vùc bªn trong 
function offlineCheckPermitRegion() 
	local nMapId, nX, nY = GetWorldPos(); 
	local nLimitX, nLimitY = 0,0; 
	local szDirection, nDistance = "", 0; 
	local i=0; 
	if aryLimitRegion[nMapId] then 
		for i=1, getn(aryLimitRegion[nMapId]) do 
			nLimitX = aryLimitRegion[nMapId][i][1]; 
			nLimitY = aryLimitRegion[nMapId][i][2]; 
			szDirection, nDistance = getDirection({nX, nY}, {nLimitX, nLimitY}); 
			--   nÕu nh­ kho¶ng c¸ch bÊt kú mét ®iÓm nhá víi 10 , lµ nãi râ ë cÊm chØ khu vùc bªn trong 
			if nDistance<=NUM_OFFLINE_PERMITREGION_MAX then 
				-- return 0; 
				return 1; 
			end; 
		end; 
		return 1; 
	else 
		return 1; 
	end; 
end; 


function StallCheckPermitRegion() 
	if offlineCheckPermitRegion() == 1 then 
		return 1 
	else 
		Talk(1, "","Kh«ng thÓ ë chç nµy khu vùc bµy s¹p ") 
	end 
end 

--   ®¹t ®­îc mét vÞ trÝ t­¬ng ®èi vu nhµ ch¬i vÞ trÝ ®Ých th©n thÓ to lín ph­¬ng vÞ 
function getDirection(posOrigin, posTarget) 

local tbStr = {"T©y nam ","Nam ","§«ng nam ","§«ng ","§«ng b¾c ","B¾c ","T©y b¾c ","T©y "}; 


local nX = posOrigin[2] - posTarget[2]; 
local nY = posTarget[1] - posOrigin[1]; 

local nDeg = atan2(posOrigin[2] - posTarget[2], posTarget[1] - posOrigin[1]); 
	local nDirection = floor(nDeg/45+4.5);

if (nDirection == 0) then 
nDirection = 8; 
end; 

--   cô thÓ kho¶ng c¸ch , lÊy chØnh sæ 
	local nDistance = floor(sqrt(nX*nX + nY*nY));

return tbStr[nDirection], nDistance; 

end; 
